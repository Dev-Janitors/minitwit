version: '3.3'

networks:
    main:

services:
    minitwitfrontend:
        image: ${DOCKER_USERNAME}/minitwitfrontendstaging
        container_name: minitwitfrontend
        depends_on:
            - backend
            - prometheus
            - grafana
        ports:
            - 3001:3001

    backend:
        image: ${DOCKER_USERNAME}/minitwitbackendstaging
        container_name: minitwitbackend
        depends_on:
            - db
        ports:
            - '2222:80'
            - '2223:443'

    db:
        image: ${DOCKER_USERNAME}/minitwitdbstaging
        container_name: minitwitdb
        ports:
            - '1433:1433'
        volumes:
            - dbvolume:/var/opt/mssql/data

    prometheus:
        image: prom/prometheus
        container_name: prometheus
        depends_on:
            - backend
        volumes:
            - promvolume:/prometheus
            - ./prometheus.yml:/etc/prometheus/prometheus.yml
        ports:
            - '9090:9090'

    grafana:
        image: grafana/grafana:latest
        container_name: grafana
        depends_on:
            - prometheus
        volumes:
            - grafvolume:/var/lib/grafana
        ports:
            - '3333:3000'

volumes:
    dbvolume:
    promvolume:
    grafvolume:
